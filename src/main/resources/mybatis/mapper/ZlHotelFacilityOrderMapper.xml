<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhiliao.hotel.mapper.ZlHotelFacilityOrderMapper">
    <resultMap id="BaseResultMap" type="com.zhiliao.hotel.model.ZlHotelFacilityOrder">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 28 09:49:18 CST 2020.
        -->
        <result column="OrderID" jdbcType="BIGINT" property="orderid"/>
        <result column="FacilityID" jdbcType="INTEGER" property="facilityid"/>
        <result column="UserID" jdbcType="BIGINT" property="userid"/>
        <result column="SerialNumber" jdbcType="CHAR" property="serialnumber"/>
        <result column="HotelID" jdbcType="INTEGER" property="hotelid"/>
        <result column="HotelName" jdbcType="CHAR" property="hotelname"/>
        <result column="RoomID" jdbcType="INTEGER" property="roomid"/>
        <result column="RoomNumber" jdbcType="CHAR" property="roomnumber"/>
        <result column="FacilityName" jdbcType="CHAR" property="facilityname"/>
        <result column="CoverUrl" jdbcType="CHAR" property="coverurl"/>
        <result column="Remark" jdbcType="CHAR" property="remark"/>
        <result column="TotalPrice" jdbcType="DECIMAL" property="totalprice"/>
        <result column="ActuallyPay" jdbcType="DECIMAL" property="actuallypay"/>
        <result column="PayType" jdbcType="TINYINT" property="paytype"/>
        <result column="ComeFormID" jdbcType="INTEGER" property="comeformid"/>
        <result column="UseBeginDate" jdbcType="INTEGER" property="usebegindate"/>
        <result column="UseEndDate" jdbcType="INTEGER" property="useenddate"/>
        <result column="PayStatus" jdbcType="TINYINT" property="paystatus"/>
        <result column="OrderStatus" jdbcType="TINYINT" property="orderstatus"/>
        <result column="OperatorName" jdbcType="CHAR" property="operatorname"/>
        <result column="OperatorIP" jdbcType="CHAR" property="operatorip"/>
        <result column="OperatorRemark" jdbcType="CHAR" property="operatorremark"/>
        <result column="IsDelete" jdbcType="BIT" property="isdelete"/>
        <result column="IsUserDelete" jdbcType="BIT" property="isuserdelete"/>
        <result column="CreateDate" jdbcType="INTEGER" property="createdate"/>
        <result column="UpdateDate" jdbcType="INTEGER" property="updatedate"/>
    </resultMap>


    <select id="findAllOrder" resultType="com.zhiliao.hotel.model.ZlHotelFacilityOrder">
        select *
        from zl_hotelfacilityorder
        where 1 = 1 and IsDelete = 0
        and UserID = #{userId}
        and HotelID = #{hotelId}
        <if test="orderStatus != null">
            and OrderStatus = #{orderStatus}
        </if>
        order by CreateDate DESC
    </select>

    <select id="findOrderById" resultType="com.zhiliao.hotel.model.ZlHotelFacilityOrder">
    select * from zl_hotelfacilityorder where OrderID = #{orderID} and IsDelete = 0
  </select>

    <select id="findOrderByIdVO" resultType="com.zhiliao.hotel.controller.hotelfacility.vo.HotelFacilityOrderParamVO">
      SELECT
          zo.OrderID,
          zo.FacilityID,
          zo.UserID,
          zo.HotelName,
          zo.RoomID,
          zo.RoomNumber,
          zo.OrderStatus,
          zo.FacilityName,
          zo.CoverUrl,
          zo.Remark,
          zf.Price,
          zo.TotalPrice,
          zo.ActuallyPay,
          zo.PayType,
          zo.ComeFormID,
          zo.UseBeginDate,
          zo.UseEndDate,
          zo.CreateDate,
          zo.UpdateDate,
          zf.CanCancelOrderMinute,
          zo.SerialNumber,
          zf.ChargeMethod,
          zf.OnceUseMinute,
          zf.BookMoney
        FROM
          zl_hotelfacilityorder zo
          LEFT JOIN zl_hotelfacility zf
            ON zo.FacilityID = zf.FacilityID
        WHERE zo.OrderID = #{orderID}
          AND zo.IsDelete = 0
          AND zo.IsUserDelete = 0
  </select>

    <update id="byOrderId" parameterType="com.zhiliao.hotel.model.ZlHotelFacilityOrder">
    update zl_hotelfacilityorder set OrderStatus = #{orderstatus} and UpdateDate = #{updatedate} where OrderID = #{orderid}
  </update>

    <select id="findByBiginAndEndDate" resultType="com.zhiliao.hotel.model.ZlHotelFacilityOrder">
    select *
    from zl_hotelfacilityorder
    where (BeginUseDate &lt;= #{beginusedate}
    or EndUseDate &gt;  #{endusedate})
    and HotelID = #{hotelid}
    and FacilityID = #{facilityid}
  </select>

    <update id="updateById" parameterType="com.zhiliao.hotel.model.ZlHotelFacilityOrder">
    UPDATE
      zl_hotelfacilityorder
    SET
      OrderStatus = - 1,
      UpdateDate = #{updateDate}
    WHERE OrderID = #{orderID}
      AND IsDelete = 0
      AND IsUserDelete = 0
  </update>

    <update id="userDeleteFacilityOrder">
    UPDATE
      zl_hotelfacilityorder
    SET
      IsUserDelete = 1,
      UpdateDate = #{updateDate}
    WHERE OrderID = #{orderID}
      AND IsDelete = '0'
      AND IsUserDelete = '0'
  </update>
    <select id="selectToPhp" resultType="com.zhiliao.hotel.controller.hotelfacility.vo.ZlHotelFacilityOrderToPhpVO">
        select * from zl_hotelfacilityorder where OrderID = #{orderid}
    </select>
</mapper>