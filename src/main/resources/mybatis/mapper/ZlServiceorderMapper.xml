<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhiliao.hotel.mapper.ZlServiceorderMapper">
    <resultMap id="BaseResultMap" type="com.zhiliao.hotel.model.ZlServiceorder">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Wed May 20 17:41:35 CST 2020.
        -->
        <result column="OrderID" jdbcType="BIGINT" property="orderid"/>
        <result column="UserID" jdbcType="BIGINT" property="userid"/>
        <result column="UserName" jdbcType="CHAR" property="username"/>
        <result column="Tel" jdbcType="CHAR" property="tel"/>
        <result column="SerialNumber" jdbcType="CHAR" property="serialnumber"/>
        <result column="ServiceItem" jdbcType="CHAR" property="serviceitem"/>
        <result column="HotelID" jdbcType="INTEGER" property="hotelid"/>
        <result column="HotelName" jdbcType="CHAR" property="hotelname"/>
        <result column="RoomID" jdbcType="INTEGER" property="roomid"/>
        <result column="GoodsCoverUrl" jdbcType="VARCHAR" property="goodscoverurl"/>
        <result column="FloorNumber" jdbcType="CHAR" property="floornumber"/>
        <result column="RoomNumber" jdbcType="CHAR" property="roomnumber"/>
        <result column="ComeFormID" jdbcType="INTEGER" property="comeformid"/>
        <result column="DeliveryDate" jdbcType="INTEGER" property="deliverydate"/>
        <result column="TimeoutDate" jdbcType="INTEGER" property="timeoutdate"/>
        <result column="Remark" jdbcType="CHAR" property="remark"/>
        <result column="OrderStatus" jdbcType="TINYINT" property="orderstatus"/>
        <result column="OperatorName" jdbcType="CHAR" property="operatorname"/>
        <result column="OperatorIP" jdbcType="CHAR" property="operatorip"/>
        <result column="OperatorRemark" jdbcType="CHAR" property="operatorremark"/>
        <result column="IsDelete" jdbcType="BIT" property="isdelete"/>
        <result column="IsUserDelete" jdbcType="BIT" property="isuserdelete"/>
        <result column="CreateDate" jdbcType="INTEGER" property="createdate"/>
        <result column="UpdateDate" jdbcType="INTEGER" property="updatedate"/>
    </resultMap>

    <sql id="selectColumn">
    OrderID, UserID, UserName, Tel, SerialNumber, ServiceItem, HotelID, HotelName, RoomID, GoodsCoverUrl, FloorNumber,BookDate
    RoomNumber, ComeFormID, DeliveryDate, TimeoutDate, Remark, OrderStatus, OperatorName, OperatorIP, OperatorRemark,
    CreateDate, UpdateDate
  </sql>

    <!--<insert id="insert" parameterType="com.zhiliao.hotel.model.ZlServiceorder" useGeneratedKeys="true"-->
    <!--keyProperty="orderid">-->
    <!--&lt;!&ndash;-->
    <!--WARNING - @mbg.generated-->
    <!--This element is automatically generated by MyBatis Generator, do not modify.-->
    <!--This element was generated on Wed May 20 17:41:35 CST 2020.-->
    <!--&ndash;&gt;-->
    <!--insert into zl_serviceorder (UserID, UserName, Tel, SerialNumber,-->
    <!--HotelID, HotelName, RoomID, GoodsCoverUrl, FloorNumber,-->
    <!--RoomNumber, ComeFormID, DeliveryDate, TimeoutDate, Remark,-->
    <!--CreateDate)-->
    <!--values (#{userid,jdbcType=BIGINT}, #{username,jdbcType=CHAR}, #{tel,jdbcType=CHAR},-->
    <!--#{serialnumber,jdbcType=CHAR},-->
    <!--#{hotelid,jdbcType=INTEGER}, #{hotelname,jdbcType=CHAR}, #{roomid,jdbcType=INTEGER},-->
    <!--#{goodscoverurl,jdbcType=VARCHAR}, #{floornumber,jdbcType=CHAR},-->
    <!--#{roomnumber,jdbcType=CHAR}, #{comeformid,jdbcType=INTEGER}, #{deliverydate,jdbcType=INTEGER},-->
    <!--#{timeoutdate,jdbcType=INTEGER}, #{remark,jdbcType=CHAR},-->
    <!--#{createdate,jdbcType=INTEGER})-->
    <!--/*获取刚插入的数据的自增ID*/-->
    <!--<selectKey keyProperty="orderid" order="AFTER" resultType="java.lang.Long">-->
    <!--SELECT LAST_INSERT_ID()-->
    <!--</selectKey>-->
    <!--</insert>-->
    <!--<insert id="insertSelective" parameterType="com.zhiliao.hotel.model.ZlServiceorder">-->
    <!--&lt;!&ndash;-->
    <!--WARNING - @mbg.generated-->
    <!--This element is automatically generated by MyBatis Generator, do not modify.-->
    <!--This element was generated on Wed May 20 17:41:35 CST 2020.-->
    <!--&ndash;&gt;-->
    <!--insert into zl_serviceorder-->
    <!--<trim prefix="(" suffix=")" suffixOverrides=",">-->
    <!--<if test="orderid != null">-->
    <!--OrderID,-->
    <!--</if>-->
    <!--<if test="userid != null">-->
    <!--UserID,-->
    <!--</if>-->
    <!--<if test="serialnumber != null">-->
    <!--SerialNumber,-->
    <!--</if>-->
    <!--<if test="hotelid != null">-->
    <!--HotelID,-->
    <!--</if>-->
    <!--<if test="hotelname != null">-->
    <!--HotelName,-->
    <!--</if>-->
    <!--<if test="roomid != null">-->
    <!--RoomID,-->
    <!--</if>-->
    <!--<if test="roomnumber != null">-->
    <!--RoomNumber,-->
    <!--</if>-->
    <!--<if test="comeformid != null">-->
    <!--ComeFormID,-->
    <!--</if>-->
    <!--<if test="remark != null">-->
    <!--Remark,-->
    <!--</if>-->
    <!--<if test="orderstatus != null">-->
    <!--OrderStatus,-->
    <!--</if>-->
    <!--<if test="operatorname != null">-->
    <!--OperatorName,-->
    <!--</if>-->
    <!--<if test="operatorip != null">-->
    <!--OperatorIP,-->
    <!--</if>-->
    <!--<if test="operatorremark != null">-->
    <!--OperatorRemark,-->
    <!--</if>-->
    <!--<if test="isdelete != null">-->
    <!--IsDelete,-->
    <!--</if>-->
    <!--<if test="createdate != null">-->
    <!--CreateDate,-->
    <!--</if>-->
    <!--<if test="updatedate != null">-->
    <!--UpdateDate,-->
    <!--</if>-->
    <!--</trim>-->
    <!--<trim prefix="values (" suffix=")" suffixOverrides=",">-->
    <!--<if test="orderid != null">-->
    <!--#{orderid,jdbcType=BIGINT},-->
    <!--</if>-->
    <!--<if test="userid != null">-->
    <!--#{userid,jdbcType=BIGINT},-->
    <!--</if>-->
    <!--<if test="serialnumber != null">-->
    <!--#{serialnumber,jdbcType=CHAR},-->
    <!--</if>-->
    <!--<if test="hotelid != null">-->
    <!--#{hotelid,jdbcType=INTEGER},-->
    <!--</if>-->
    <!--<if test="hotelname != null">-->
    <!--#{hotelname,jdbcType=CHAR},-->
    <!--</if>-->
    <!--<if test="roomid != null">-->
    <!--#{roomid,jdbcType=INTEGER},-->
    <!--</if>-->
    <!--<if test="roomnumber != null">-->
    <!--#{roomnumber,jdbcType=CHAR},-->
    <!--</if>-->
    <!--<if test="comeformid != null">-->
    <!--#{comeformid,jdbcType=INTEGER},-->
    <!--</if>-->
    <!--<if test="remark != null">-->
    <!--#{remark,jdbcType=CHAR},-->
    <!--</if>-->
    <!--<if test="orderstatus != null">-->
    <!--#{orderstatus,jdbcType=TINYINT},-->
    <!--</if>-->
    <!--<if test="operatorname != null">-->
    <!--#{operatorname,jdbcType=CHAR},-->
    <!--</if>-->
    <!--<if test="operatorip != null">-->
    <!--#{operatorip,jdbcType=CHAR},-->
    <!--</if>-->
    <!--<if test="operatorremark != null">-->
    <!--#{operatorremark,jdbcType=CHAR},-->
    <!--</if>-->
    <!--<if test="isdelete != null">-->
    <!--#{isdelete,jdbcType=BIT},-->
    <!--</if>-->
    <!--<if test="createdate != null">-->
    <!--#{createdate,jdbcType=INTEGER},-->
    <!--</if>-->
    <!--<if test="updatedate != null">-->
    <!--#{updatedate,jdbcType=INTEGER},-->
    <!--</if>-->
    <!--</trim>-->
    <!--</insert>-->

    <select id="getByOrderIdDetil" resultType="com.zhiliao.hotel.controller.myAppointment.dto.ZlServiceorderDTO2">
        SELECT
        OrderID,
        UserID,
        UserName,
        Tel,
        SerialNumber,
        ServiceItem,
        HotelID,
        HotelName,
        RoomID,
        GoodsCoverUrl,
        FloorNumber,
        BookDate,
        RoomNumber,
        ComeFormID,
        DeliveryDate,
        TimeoutDate,
        Remark,
        OrderStatus,
        CASE
          OrderStatus
          WHEN - 1
          THEN '已取消'
          WHEN 0
          THEN '待配送'
          WHEN 1
          THEN '已完成'
          WHEN 2
          THEN '已接单'
        END StatusMessage,
        OperatorName,
        OperatorIP,
        OperatorRemark,
        CreateDate,
        UpdateDate
        FROM
        zl_serviceorder
        WHERE OrderID = #{orderId}
        AND IsDelete = 0
        AND IsUserDelete = 0
    </select>

    <select id="getByOrderId" resultType="com.zhiliao.hotel.model.ZlServiceorder">
        SELECT
        OrderID,
        UserID,
        UserName,
        Tel,
        SerialNumber,
        ServiceItem,
        HotelID,
        HotelName,
        RoomID,
        GoodsCoverUrl,
        FloorNumber,
        BookDate,
        RoomNumber,
        ComeFormID,
        DeliveryDate,
        TimeoutDate,
        Remark,
        OrderStatus,
        OperatorName,
        OperatorIP,
        OperatorRemark,
        CreateDate,
        UpdateDate
        FROM
        zl_serviceorder
        WHERE OrderID = #{orderId}
        AND IsDelete = 0
        AND IsUserDelete = 0
    </select>

    <update id="updateOrderStatusById">
    UPDATE zl_serviceorder so SET so.OrderStatus = -1, so.UpdateDate = #{updateDate}, CancelUserType = 1, CancelRemark = '用户取消' WHERE so.OrderID = #{orderId} AND so.IsDelete = 0 AND so.IsUserDelete = 0
  </update>


    <update id="userDeleteServiceOrder">
    UPDATE
      zl_serviceorder
    SET
      IsUserDelete = 1,
      UpdateDate = #{updateDate}
    WHERE OrderID = #{orderid}
      AND IsDelete = '0'
      AND IsUserDelete = '0'
  </update>
    <select id="selectToPhp" resultType="com.zhiliao.hotel.controller.serviceorder.vo.ServiceorderToPhpVO">
        select * from zl_serviceorder where OrderID = #{orderid}
    </select>
</mapper>