<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhiliao.hotel.mapper.ZlOrderMapper">

    <select id="findAllOrder"
            resultType="com.zhiliao.hotel.controller.myOrder.vo.OrderList"
            parameterType="com.zhiliao.hotel.controller.myOrder.vo.OrderInfoVO">

        SELECT
        UserID,
        HotelName,
        ActuallyPay,
        BelongModule,
        CouponID,
        PayStatus,
        OrderStatus,
        RefundStatus,
        IsDelete,
        IsUserDelete,
        CreateDate,
        UpdateDate
        FROM zl_order WHERE UserID=#{userId}

        <if test="paytype != null">
            AND PayType = #{paytype}
        </if>

        <if test="paystatus != null">
            AND PayStatus = #{paystatus}
        </if>

        <if test="orderstatus != null">
            AND OrderStatus = #{orderstatus}
        </if>

        <if test="refundstatus != null">
            AND RefundStatus = #{refundstatus}
        </if>

        <if test="belongmodule != null">
            AND BelongModule = #{belongmodule}
        </if>

        ORDER BY CreateDate DESC

    </select>

    <select id="findById"
            resultType="com.zhiliao.hotel.model.ZlOrder">
    select * from zl_order where OrderID = #{orderid}
  </select>
    <!--<update id="byOrderId"-->
    <!--parameterType="com.zhiliao.hotel.model.ZlOrder">-->
    <!--update zl_order set OrderStatus = #{orderstatus},UpdateDate = #{updatedate} where OrderID = #{orderid}-->
    <!--</update>-->

    <select id="getOrderDetail"
            resultType="com.zhiliao.hotel.controller.myOrder.vo.OrderDetailVO">
        SELECT
          zod.HotelGoodsID,
          zod.GoodsCount,
          zod.Price
        FROM
          zl_orderdetail zod
          LEFT JOIN zl_order zo
            ON zod.OrderID = zo.OrderID
        WHERE zo.OrderSerialNo = #{out_trade_no}
        ORDER BY zod.HotelGoodsID ASC
    </select>

    <update id="updateOrder">
        UPDATE
          zl_order
        SET
          PayStatus = 2,
          OrderStatus = 1
        WHERE OrderSerialNo = #{out_trade_no}
    </update>

    <select id="getByOrderSerialNo" resultType="com.zhiliao.hotel.controller.myOrder.vo.OrderStatusVO">
        SELECT DISTINCT
          OrderSerialNo,
          PayStatus,
          OrderStatus
        FROM
          zl_order
        WHERE OrderSerialNo = #{out_trade_no}
    </select>

    <update id="updateOrderUpdateDate">
        UPDATE
          zl_order
        SET
          UpdateDate = #{updateDate}
        WHERE OrderSerialNo = #{out_trade_no}
          AND BelongModule = #{belongModule}
    </update>

</mapper>
