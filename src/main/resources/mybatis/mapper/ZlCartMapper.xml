<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.zhiliao.hotel.mapper.ZlCartMapper">
    <resultMap id="BaseResultMap" type="com.zhiliao.hotel.model.ZlCart">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Apr 14 11:52:04 SGT 2020.
        -->
        <result column="CartID" jdbcType="BIGINT" property="cartid"/>
        <result column="UserID" jdbcType="BIGINT" property="userid"/>
        <result column="HotelID" jdbcType="INTEGER" property="hotelid"/>
        <result column="SkuID" jdbcType="INTEGER" property="skuid"/>
        <result column="GoodsCount" jdbcType="INTEGER" property="goodscount"/>
        <result column="CreateDate" jdbcType="INTEGER" property="createdate"/>
        <result column="UpdateDate" jdbcType="INTEGER" property="updatedate"/>
    </resultMap>

    <update id="updateCartGoodsCount">
        update zl_cart set GoodsCount=#{goodsCount},UpdateDate=#{updateDate} where CartID=#{cartId}
    </update>

    <select id="findUserCart" resultType="com.zhiliao.hotel.controller.cart.vo.UserCartVo">
        select
            zc.CartID,
            zg.GoodsName,
            zgs.CurrentPrice,
            zc.GoodsCount
        from zl_cart zc
        left join zl_goodssku zgs on zc.SkuID=zgs.SkuID
        left join zl_goods zg on zgs.GoodsID=zg.GoodsID
        left join zl_goodscategory zgc on zg.GoodsCategoryID=zgc.GoodsCategoryID
        where zgs.IsDelete=0 and zg.GoodsStatus=1 and zg.IsDelete=0
        and zc.UserID=#{userId} and zc.HotelID=#{hotelId} and zgc.BelongModule=#{belongModule}
        order by zc.CreateDate desc
    </select>

    <delete id="emptyCart">
        delete from zl_cart where CartID
        in(
        select a.CartID from
        (select zc.CartID from zl_cart zc
        left join zl_goodssku zgs on zc.SkuID=zgs.SkuID
        left join zl_goods zg on zgs.GoodsID=zg.GoodsID
        left join zl_goodscategory zgc on zg.GoodsCategoryID=zgc.GoodsCategoryID
        where zc.UserID=#{userId} and zc.HotelID=#{hotelId} and zgc.BelongModule=#{belongModule}) a
        )
    </delete>

</mapper>