<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhiliao.hotel.mapper.ZlHotelFacilityMapper">
    <resultMap id="BaseResultMap" type="com.zhiliao.hotel.model.ZlHotelFacility">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat May 23 09:44:32 CST 2020.
        -->
        <result column="FacilityID" jdbcType="INTEGER" property="facilityid"/>
        <result column="HotelID" jdbcType="INTEGER" property="hotelid"/>
        <result column="FacilityName" jdbcType="CHAR" property="facilityname"/>
        <result column="FacilityCount" jdbcType="INTEGER" property="facilitycount"/>
        <result column="FacilityRemainCount" jdbcType="INTEGER" property="facilityremaincount"/>
        <result column="AllowPersonCount" jdbcType="INTEGER" property="allowpersoncount"/>
        <result column="ImgUrl" jdbcType="VARCHAR" property="imgurl"/>
        <result column="ServiceBeginDate" jdbcType="INTEGER" property="servicebegindate"/>
        <result column="ServiceEndDate" jdbcType="INTEGER" property="serviceenddate"/>
        <result column="UseMinute" jdbcType="INTEGER" property="useminute"/>
        <result column="UseCount" jdbcType="INTEGER" property="usecount"/>
        <result column="CanCancelOrderMinute" jdbcType="INTEGER" property="cancancelorderminute"/>
        <result column="Price" jdbcType="DECIMAL" property="price"/>
        <result column="FacilityStatus" jdbcType="TINYINT" property="facilitystatus"/>
        <result column="Sort" jdbcType="INTEGER" property="sort"/>
        <result column="BookMoney" jdbcType="DECIMAL" property="bookmoney"/>
        <result column="IsDelete" jdbcType="BIT" property="isdelete"/>
        <result column="CreateDate" jdbcType="INTEGER" property="createdate"/>
        <result column="UpdateDate" jdbcType="INTEGER" property="updatedate"/>
    </resultMap>

    <select id="getHotelFacilityList" resultType="com.zhiliao.hotel.model.ZlHotelFacility">
    select
        FacilityID,
        HotelID,
        FacilityCount,
        FacilityName,
        ImgUrl,
        FacilityRemainCount,
        AllowPersonCount,
        Content,
        ServiceBeginDate,
        ServiceEndDate,
        UseMinute,
        UseCount,
        CanCancelOrderMinute,
        Price,
        BookMoney,
        ChargeMethod,
        CreateDate,
        OnceUseMinute
    from zl_hotelfacility
    where HotelID = #{hotelId} and FacilityStatus = 1 and IsDelete = 0 AND CheckStatus = 2
    order by CreateDate DESC
  </select>

    <select id="getHotelFacilityDetail" resultType="com.zhiliao.hotel.model.ZlHotelFacility">
    select
        FacilityID,
        HotelID,
        FacilityCount,
        FacilityName,
        ImgUrl,
        FacilityRemainCount,
        AllowPersonCount,
        Content,
        ServiceBeginDate,
        ServiceEndDate,
        UseMinute,
        UseCount,
        CanCancelOrderMinute,
        Price,
        ChargeMethod,
        BookMoney,
        CreateDate,
        OnceUseMinute
    from
        zl_hotelfacility
    where
        FacilityID = #{facilityId}
        AND FacilityStatus = 1
        AND IsDelete = 0
        AND CheckStatus = 2
  </select>

    <update id="updateCount">
        update zl_hotelfacility set FacilityCount = FacilityCount - 1,FacilityRemainCount = FacilityRemainCount - 1,UseCount = UseCount + 1,UpdateDate = #{time} where FacilityID = #{facilityID}
    </update>

    <update id="updateByFacilityId" parameterType="com.zhiliao.hotel.model.ZlHotelFacility">
      UPDATE
          zl_hotelfacility
        SET
          FacilityCount = FacilityCount + 1,
          FacilityRemainCount = FacilityRemainCount + 1,
          UseCount = UseCount - 1,
          UpdateDate = #{updateDate}
        WHERE FacilityID = #{facilityId}
          AND FacilityStatus = 1
          AND IsDelete = 0
    </update>
</mapper>