<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhiliao.hotel.mapper.ZlRentCarGoodsMapper">
  <resultMap id="BaseResultMap" type="com.zhiliao.hotel.model.ZlRentCarGoods">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Jun 06 08:53:52 CST 2020.
    -->
    <result column="GoodsID" jdbcType="INTEGER" property="goodsid" />
    <result column="HotelID" jdbcType="INTEGER" property="hotelid" />
    <result column="CoverImgUrl" jdbcType="CHAR" property="coverimgurl" />
    <result column="GoodsName" jdbcType="CHAR" property="goodsname" />
    <result column="CarNumber" jdbcType="CHAR" property="carnumber" />
    <result column="Tags" jdbcType="CHAR" property="tags" />
    <result column="RentPrice" jdbcType="DECIMAL" property="rentprice" />
    <result column="StockCount" jdbcType="INTEGER" property="stockcount" />
    <result column="RealtimeStockCount" jdbcType="INTEGER" property="realtimestockcount" />
    <result column="CanCancelOrderMinute" jdbcType="INTEGER" property="cancancelorderminute" />
    <result column="GoodsStatus" jdbcType="TINYINT" property="goodsstatus" />
    <result column="CheckStatus" jdbcType="TINYINT" property="checkstatus" />
    <result column="Sort" jdbcType="INTEGER" property="sort" />
    <result column="IsDelete" jdbcType="BIT" property="isdelete" />
    <result column="CreateDate" jdbcType="INTEGER" property="createdate" />
    <result column="UpdateDate" jdbcType="INTEGER" property="updatedate" />
  </resultMap>

  <select id="carGoodsList" resultType="com.zhiliao.hotel.model.ZlRentCarGoods">
    select
    GoodsID,
    CoverImgUrl,
    GoodsName,
    CarNumber,
    Tags,
    RentPrice,
    CreateDate
    from
    zl_rentcargoods
    where GoodsStatus = 1 and IsDelete = 0
    <if test="hotelid != null">
      and HotelID = #{hotelid}
    </if>
    order by Sort ASC
  </select>

  <select id="rentCarDetail" resultType="com.zhiliao.hotel.model.ZlRentCarGoods">
      SELECT
          zg.GoodsID,
          zg.HotelID,
          zg.CoverImgUrl,
          zg.GoodsName,
          zg.CarNumber,
          zg.Tags,
          zg.RentPrice,
          zg.StockCount,
          zg.CanCancelOrderMinute,
          zg.CheckStatus,
          zg.Sort,
          zg.Content,
          zg.CreateDate,
          zg.UpdateDate,
          zt.Url
        FROM
          zl_treaty zty
          LEFT JOIN zl_hoteltreaty zt
            ON zt.TreatyType = zty.TreatyTypeID
          LEFT JOIN zl_rentcargoods zg
            ON zt.HotelID = zg.HotelID
        WHERE zty.TreatyTypeID = 1
          AND zt.Status = 1
          AND zt.IsDelete = 0
          AND zty.IsDelete = 0
          AND zg.GoodsID = #{goodsid}
          AND zg.GoodsStatus = 1
          AND zg.IsDelete = 0
  </select>
    <update id="updateStockCountDecrease">
        UPDATE
          zl_rentcargoods
        SET
          StockCount = StockCount - 1
        WHERE GoodsID = #{goodsid}
    </update>
    <update id="updateStockCountAdd">
        UPDATE
          zl_rentcargoods
        SET
          StockCount = StockCount + 1
        WHERE GoodsID = #{goodsid}
    </update>
</mapper>