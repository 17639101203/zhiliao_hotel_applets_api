<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhiliao.hotel.mapper.ZlServiceorderdetailMapper">
  <resultMap id="BaseResultMap" type="com.zhiliao.hotel.model.ZlServiceorderdetail">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat May 23 14:48:17 CST 2020.
    -->
    <result column="OrderDetailID" jdbcType="BIGINT" property="orderdetailid" />
    <result column="OrderID" jdbcType="BIGINT" property="orderid" />
    <result column="UserID" jdbcType="BIGINT" property="userid" />
    <result column="GoodsID" jdbcType="INTEGER" property="goodsid" />
    <result column="GoodsName" jdbcType="VARCHAR" property="goodsname" />
    <result column="GoodsCoverUrl" jdbcType="VARCHAR" property="goodscoverurl" />
    <result column="Price" jdbcType="DECIMAL" property="price" />
    <result column="GoodsCount" jdbcType="INTEGER" property="goodscount" />
    <result column="IsDelete" jdbcType="BIT" property="isdelete" />
    <result column="CreateDate" jdbcType="INTEGER" property="createdate" />
    <result column="UpdateDate" jdbcType="INTEGER" property="updatedate" />
  </resultMap>
  <!--<insert id="insert" parameterType="com.zhiliao.hotel.model.ZlServiceorderdetail">-->
    <!--&lt;!&ndash;-->
      <!--WARNING - @mbg.generated-->
      <!--This element is automatically generated by MyBatis Generator, do not modify.-->
      <!--This element was generated on Sat May 23 14:48:17 CST 2020.-->
    <!--&ndash;&gt;-->
    <!--insert into zl_serviceorderdetail (OrderDetailID, OrderID, UserID, -->
      <!--GoodsID, GoodsName, GoodsCoverUrl, -->
      <!--Price, GoodsCount, IsDelete, -->
      <!--CreateDate, UpdateDate)-->
    <!--values (#{orderdetailid,jdbcType=BIGINT}, #{orderid,jdbcType=BIGINT}, #{userid,jdbcType=BIGINT}, -->
      <!--#{goodsid,jdbcType=INTEGER}, #{goodsname,jdbcType=VARCHAR}, #{goodscoverurl,jdbcType=VARCHAR}, -->
      <!--#{price,jdbcType=DECIMAL}, #{goodscount,jdbcType=INTEGER}, #{isdelete,jdbcType=BIT}, -->
      <!--#{createdate,jdbcType=INTEGER}, #{updatedate,jdbcType=INTEGER})-->
  <!--</insert>-->
  <!--<insert id="insertSelective" parameterType="com.zhiliao.hotel.model.ZlServiceorderdetail">-->
    <!--&lt;!&ndash;-->
      <!--WARNING - @mbg.generated-->
      <!--This element is automatically generated by MyBatis Generator, do not modify.-->
      <!--This element was generated on Sat May 23 14:48:17 CST 2020.-->
    <!--&ndash;&gt;-->
    <!--insert into zl_serviceorderdetail-->
    <!--<trim prefix="(" suffix=")" suffixOverrides=",">-->
      <!--<if test="orderdetailid != null">-->
        <!--OrderDetailID,-->
      <!--</if>-->
      <!--<if test="orderid != null">-->
        <!--OrderID,-->
      <!--</if>-->
      <!--<if test="userid != null">-->
        <!--UserID,-->
      <!--</if>-->
      <!--<if test="goodsid != null">-->
        <!--GoodsID,-->
      <!--</if>-->
      <!--<if test="goodsname != null">-->
        <!--GoodsName,-->
      <!--</if>-->
      <!--<if test="goodscoverurl != null">-->
        <!--GoodsCoverUrl,-->
      <!--</if>-->
      <!--<if test="price != null">-->
        <!--Price,-->
      <!--</if>-->
      <!--<if test="goodscount != null">-->
        <!--GoodsCount,-->
      <!--</if>-->
      <!--<if test="isdelete != null">-->
        <!--IsDelete,-->
      <!--</if>-->
      <!--<if test="createdate != null">-->
        <!--CreateDate,-->
      <!--</if>-->
      <!--<if test="updatedate != null">-->
        <!--UpdateDate,-->
      <!--</if>-->
    <!--</trim>-->
    <!--<trim prefix="values (" suffix=")" suffixOverrides=",">-->
      <!--<if test="orderdetailid != null">-->
        <!--#{orderdetailid,jdbcType=BIGINT},-->
      <!--</if>-->
      <!--<if test="orderid != null">-->
        <!--#{orderid,jdbcType=BIGINT},-->
      <!--</if>-->
      <!--<if test="userid != null">-->
        <!--#{userid,jdbcType=BIGINT},-->
      <!--</if>-->
      <!--<if test="goodsid != null">-->
        <!--#{goodsid,jdbcType=INTEGER},-->
      <!--</if>-->
      <!--<if test="goodsname != null">-->
        <!--#{goodsname,jdbcType=VARCHAR},-->
      <!--</if>-->
      <!--<if test="goodscoverurl != null">-->
        <!--#{goodscoverurl,jdbcType=VARCHAR},-->
      <!--</if>-->
      <!--<if test="price != null">-->
        <!--#{price,jdbcType=DECIMAL},-->
      <!--</if>-->
      <!--<if test="goodscount != null">-->
        <!--#{goodscount,jdbcType=INTEGER},-->
      <!--</if>-->
      <!--<if test="isdelete != null">-->
        <!--#{isdelete,jdbcType=BIT},-->
      <!--</if>-->
      <!--<if test="createdate != null">-->
        <!--#{createdate,jdbcType=INTEGER},-->
      <!--</if>-->
      <!--<if test="updatedate != null">-->
        <!--#{updatedate,jdbcType=INTEGER},-->
      <!--</if>-->
    <!--</trim>-->
  <!--</insert>-->

  <select id="getBuyNumByOrderIds" resultType="com.zhiliao.hotel.model.ZlServiceorderdetail">
    SELECT zsd.GoodsID AS goodsid, COUNT(1) AS buyNum, SUM(goodscount) AS goodscount
    FROM zl_serviceorderdetail zsd
    WHERE zsd.GoodsID IN (${goodsId}) AND zsd.IsDelete = 0 AND zsd.IsUserDelete = 0
    AND zsd.OrderID IN
    (SELECT zs.OrderID FROM zl_serviceorder zs
    WHERE zs.HotelID = #{hotleId} AND zs.RoomID = #{roomID}
    AND zs.IsDelete = 0 AND zs.OrderStatus IN ('0','1') AND zs.IsUserDelete = 0
    AND zs.CreateDate BETWEEN #{start} AND #{end})
    GROUP BY zsd.GoodsID
  </select>

  <insert id="insertOrderDetailList" parameterType="java.util.ArrayList">
    INSERT INTO zl_serviceorderdetail (OrderID, UserID,
    GoodsID, GoodsName, GoodsCoverUrl, Price, GoodsCount, CreateDate, UpdateDate) VALUES
    <foreach collection="zlServiceorderdetails" index="index" separator="," item="item">
        (#{item.orderid,jdbcType=BIGINT}, #{item.userid,jdbcType=BIGINT},
        #{item.goodsid,jdbcType=INTEGER}, #{item.goodsname,jdbcType=VARCHAR}, #{item.goodscoverurl,jdbcType=VARCHAR},
        #{item.price,jdbcType=DECIMAL}, #{item.goodscount,jdbcType=INTEGER}, #{item.createdate,jdbcType=INTEGER}),
      #{item.updatedate,jdbcType=INTEGER})
    </foreach>
  </insert>

  <select id="findByOrderId" resultMap="BaseResultMap">
    SELECT zsd.OrderID, zsd.GoodsID, zsd.GoodsName, zsd.GoodsCoverUrl, zsd.GoodsCount
    FROM zl_serviceorderdetail zsd
    WHERE zsd.OrderID = #{orderId} AND zsd.IsDelete = 0 AND zsd.IsUserDelete = 0
  </select>
</mapper>