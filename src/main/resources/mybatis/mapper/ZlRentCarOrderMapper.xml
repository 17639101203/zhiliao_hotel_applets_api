<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zhiliao.hotel.mapper.ZlRentCarOrderMapper">
    <resultMap id="BaseResultMap" type="com.zhiliao.hotel.model.ZlRentCarOrder">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Sat Jun 06 14:09:32 CST 2020.
        -->
        <result column="OrderID" jdbcType="BIGINT" property="orderid"/>
        <result column="UserID" jdbcType="BIGINT" property="userid"/>
        <result column="OrderSerialNo" jdbcType="CHAR" property="orderserialno"/>
        <result column="HotelID" jdbcType="INTEGER" property="hotelid"/>
        <result column="HotelName" jdbcType="CHAR" property="hotelname"/>
        <result column="RoomID" jdbcType="INTEGER" property="roomid"/>
        <result column="RoomNumber" jdbcType="CHAR" property="roomnumber"/>
        <result column="UserName" jdbcType="CHAR" property="username"/>
        <result column="Tel" jdbcType="CHAR" property="tel"/>
        <result column="OrderStatus" jdbcType="TINYINT" property="orderstatus"/>
        <result column="OperatorName" jdbcType="CHAR" property="operatorname"/>
        <result column="OperatorIP" jdbcType="CHAR" property="operatorip"/>
        <result column="OperatorRemark" jdbcType="VARCHAR" property="operatorremark"/>
        <result column="GoodsName" jdbcType="CHAR" property="goodsname"/>
        <result column="CarNumber" jdbcType="CHAR" property="carnumber"/>
        <result column="RentBeginDate" jdbcType="INTEGER" property="rentbegindate"/>
        <result column="RentEndDate" jdbcType="INTEGER" property="rentenddate"/>
        <result column="GiveBackDate" jdbcType="INTEGER" property="givebackdate"/>
        <result column="RentPrice" jdbcType="DECIMAL" property="rentprice"/>
        <result column="RentTotalPrice" jdbcType="DECIMAL" property="renttotalprice"/>
        <result column="CanCancelOrderMinute" jdbcType="INTEGER" property="cancancelorderminute"/>
        <result column="Remark" jdbcType="VARCHAR" property="remark"/>
        <result column="IsDelete" jdbcType="BIT" property="isdelete"/>
        <result column="IsUserDelete" jdbcType="BIT" property="isuserdelete"/>
        <result column="CreateDate" jdbcType="INTEGER" property="createdate"/>
        <result column="UpdateDate" jdbcType="INTEGER" property="updatedate"/>
    </resultMap>

    <!--<select id="findAllByCarNumber" resultType="com.zhiliao.hotel.model.ZlRentCarOrder">
      select
      *
      from zl_rentcarorder
      where HotelID = #{hotelid} and CarNumber = #{carnamer}
    </select>-->
    <select id="getRentCarOrderDetail" resultType="com.zhiliao.hotel.controller.myAppointment.dto.ZlRentCarOrderDTO">
    SELECT
      zo.OrderID,
      zo.OrderSerialNo,
      zo.HotelID,
      zo.HotelName,
      zo.RoomID,
      zo.RoomNumber,
      zo.UserName,
      zg.CoverImgUrl,
      zo.Tel,
      zo.OrderStatus,
      CASE
          OrderStatus
          WHEN - 1
          THEN '已取消'
          WHEN 0
          THEN '待处理'
          WHEN 1
          THEN '已租赁'
          WHEN 2
          THEN '处理完成'
          WHEN 3
          THEN '已接单'
        END StatusMessage,
      zo.GoodsName,
      zo.CarNumber,
      zo.RentBeginDate,
      zo.RentEndDate,
      zo.GiveBackDate,
      zo.RentPrice,
      zo.RentTotalPrice,
      zo.Remark,
      zo.CanCancelOrderMinute,
      zo.CreateDate,
      zo.UpdateDate,
      zg.CoverImgUrl
    FROM
      zl_rentcarorder zo
      LEFT JOIN zl_rentcargoods zg
        ON zo.CarNumber = zg.CarNumber
    WHERE zo.OrderID = #{orderid}
      AND zo.IsDelete = 0
      AND zo.IsUserDelete = 0
  </select>

    <select id="rentCarOrderDetail" resultType="com.zhiliao.hotel.model.ZlRentCarOrder">
    select
    OrderID,
    OrderSerialNo,
    UserName,
    Tel,
    OrderStatus,
    GoodsName,
    CarNumber,
    GoodsID,
    RentBeginDate,
    RentEndDate,
    GiveBackDate,
    RentPrice,
    RentTotalPrice,
    Remark,
    CanCancelOrderMinute,
    CreateDate,
    UpdateDate
    from zl_rentcarorder
    where OrderID = #{orderid} and IsDelete = 0 and IsUserDelete = 0
  </select>

    <update id="cancelRentCarOrder">
        UPDATE
          zl_rentcarorder
        SET
          OrderStatus = -1,
          UpdateDate = #{updatedate},
          CancelUserType = 1,
          CancelRemark = '用户取消'
        WHERE OrderID = #{orderID}
          AND IsDelete = 0
  </update>

    <update id="dlRentCarOrder" parameterType="com.zhiliao.hotel.model.ZlRentCarOrder">
    update zl_rentcarorder set IsUserDelete = #{isuserdelete},UpdateDate = #{updatedate} where OrderID = #{orderid}
  </update>
    <select id="selectToPhp" resultType="com.zhiliao.hotel.controller.rentcar.vo.RentCarOrderToPhpVO">
    select * from zl_rentcarorder where OrderID = #{orderid}
  </select>
</mapper>